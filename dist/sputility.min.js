/*! SPUtility.js - v0.1.0 - 2013-03-18
* https://github.com/kitmenke/jquery.sputility
* Copyright (c) 2013 Kit Menke; Licensed MIT */
Object.create||(Object.create=function(t){function e(){}if(arguments.length>1)throw Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e}),Number.prototype.formatMoney=function(t,e,n){t=isNaN(t=Math.abs(t))?2:t,e=void 0===e?".":e,n=void 0===n?",":n;var o=this,r=0>o?"-":"",l=parseInt(o=Math.abs(+o||0).toFixed(t),10)+"",i=(i=l.length)>3?i%3:0;return r+(i?l.substr(0,i)+n:"")+l.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+n)+(t?e+Math.abs(o-l).toFixed(t).slice(2):"")},function(t,e){"use strict";function n(t){return t===void 0}function o(t,e){var o;if(v){if(e){t+="\r\n";for(o in e)e.hasOwnProperty(o)&&(t+=o+": "+e[o]+"\r\n")}n(console)?(O+=1,3===O&&(t="More than 3 errors (additional errors will not be shown):\r\n"+t),3>=O&&alert(t)):console.error(t)}}function r(t){if("string"==typeof t){var e=t.match(/[0-9,.]+/g);null!==e&&(t=e[0].replace(/,/g,""),t=parseFloat(t))}return t}function l(t){if(null===t.Controls)return null;var n=e(t.Controls).find("input");if(null!==n&&1===n.length)return n[0];throw"Unable to retrieve the input control for "+t.Name}function i(t){var e,n,r;try{for(r=0;t.childNodes.length>r;r+=1)if(8===t.childNodes[r].nodeType){if(n=t.childNodes[r].data,e=n.match(/SPField\w+/),null!==e)return e[0];break}}catch(l){o("getSPFieldType: Error getting field type",l)}return null}function a(t){var e=null;switch(t.type){case"SPFieldText":e=new b(t);break;case"SPFieldNumber":e=new m(t);break;case"SPFieldCurrency":e=new w(t);break;default:e=new y(t)}return e}function s(t){var n=null;try{if(null===t.controlsCell&&(t.controlsCell=e(t.labelCell).next()[0]),t.type=i(t.controlsCell),null===t.type)return null;n=a(t)}catch(r){o("createSPField: Error creating field for "+t.name,r)}return n}function u(t,r,l){var i,a,s=null,u="Unknown field";try{if(l)i=t;else if(i=e(t).children()[0],null===i||"NOBR"===i.nodeName)return null;u=e(i).text().trim(),a=u.lastIndexOf(" *")===u.length-2,!0===a&&(u=u.substring(0,u.length-2)),s={name:u,label:e(i),labelRow:e(t.parentNode),labelCell:t,isRequired:a,controlsRow:n(r)?null:e(r.parentNode),controlsCell:n(r)?null:r,type:null,spField:null}}catch(c){o("getFieldParams: Error getting field parameters "+u,c)}return s}function c(){if(null===F){var t,n,o=e("table.ms-formtable td.ms-formlabel"),r=e("table.ms-formtable td.ms-formbodysurvey"),l=o.length;for(g=r.length>0,F={},t=0;l>t;t+=1)n=u(o[t],r[t],g),null!==n&&(F[n.name]=n)}}function d(t,e,n){n?(t.show(),null!==e&&e.show()):(t.hide(),null!==e&&e.hide())}function h(t,e){c();var r=F.get(t);return n(r)?(o("toggleSPField: Unable to find a SPField named "+t+" - "+e),void 0):(d(r.labelRow,r.controlsRow,e),void 0)}function p(t){t.ReadOnlyLabel&&t.ReadOnlyLabel.update(t.GetValue())}function f(t,n){try{e(t.Controls).hide(),null===t.ReadOnlyLabel&&(t.ReadOnlyLabel=e("<div/>").addClass("sputility-readonly").after(t.Controls)),t.ReadOnlyLabel.html(n),t.ReadOnlyLabel.show()}catch(o){alert("Error making "+t.Name+" read only. "+(""+o))}return t}function y(t){this.Label=t.label,this.LabelRow=t.labelRow,this.Name=t.name,this.IsRequired=t.isRequired,this.Type=t.type,this.Controls=e(t.controlsCell).children()[0],this.ControlsRow=t.controlsRow,this.ReadOnlyLabel=null}function b(t){y.call(this,t),this.Textbox=l(this)}function m(t){b.call(this,t)}function w(t){m.call(this,t),this.FormatOptions={eventHandler:null,autoCorrect:!1,decimalPlaces:2}}var F=null,v=!1,g=!1,O=0;y.prototype.Show=function(){return d(this.LabelRow,this.ControlsRow,!0),this},y.prototype.Hide=function(){return d(this.LabelRow,this.ControlsRow,!1),this},y.prototype.MakeReadOnly=function(){return f(this,""+this.GetValue())},y.prototype.MakeEditable=function(){try{this.Controls.hide(),null!==this.ReadOnlyLabel&&this.ReadOnlyLabel.hide()}catch(t){alert("Error making "+this.Name+" editable. "+(""+t))}return this},y.prototype.toString=function(){return this.Name},y.prototype.GetValue=function(){throw"GetValue not yet implemented for "+this.Type+" in "+this.Name},y.prototype.SetValue=function(){throw"SetValue not yet implemented for "+this.Type+" in "+this.Name},b.prototype=Object.create(y.prototype),b.prototype.GetValue=function(){return e(this.Textbox).val()},b.prototype.SetValue=function(t){return e(this.Textbox).val(t),p(this),this},m.prototype=Object.create(b.prototype),m.prototype.GetValue=function(){return r(e(this.Textbox).val())},w.prototype=Object.create(m.prototype),w.prototype.Format=function(){this.FormatOptions.autoCorrect?(this.FormatOptions.eventHandler=e.proxy(function(){this.SetValue(this.GetFormattedValue())},this),e(this.Textbox).on("change",this.FormatOptions.eventHandler),this.FormatOptions.eventHandler()):this.FormatOptions.eventHandler&&(e(this.Textbox).off("change",this.FormatOptions.eventHandler),this.FormatOptions.eventHandler=null)},w.prototype.GetFormattedValue=function(){var t=this.GetValue();return"number"==typeof t&&(t="$"+t.formatMoney(this.FormatOptions.decimalPlaces)),t},w.prototype.MakeReadOnly=function(){return f(this,this.GetFormattedValue())},t.SPUtility={Debug:function(t){return"boolean"==typeof t&&(v=t),v},GetSPFields:function(){return c(),F},GetSPField:function(t){c();var e=F[t];if(n(e))throw"GetSPField: Unable to find a SPField named "+t;return null===e.spField&&(e.spField=s(e)),e.spField},HideSPField:function(t){h(t,!1)},ShowSPField:function(t){h(t,!0)}}}(window,jQuery);