/*! SPUtility.js - v0.1.0 - 2013-03-16
* https://github.com/kitmenke/jquery.sputility
* Copyright (c) 2013 Kit Menke; Licensed MIT */
Number.prototype.formatMoney=function(e,t,n){e=isNaN(e=Math.abs(e))?2:e,t=void 0===t?".":t,n=void 0===n?",":n;var l=this,r=0>l?"-":"",o=parseInt(l=Math.abs(+l||0).toFixed(e),10)+"",i=(i=o.length)>3?i%3:0;return r+(i?o.substr(0,i)+n:"")+o.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?t+Math.abs(l-o).toFixed(e).slice(2):"")};var SPUtility=function(e){"use strict";function t(e){return e===void 0}function n(e,n){var l;if(p){if(n){e+="\r\n";for(l in n)n.hasOwnProperty(l)&&(e+=l+": "+n[l]+"\r\n")}t(console)?(w+=1,3===w&&(e="More than 3 errors (additional errors will not be shown):\r\n"+e),3>=w&&alert(e)):console.error(e)}}function l(e){if(null===e.Controls)return null;var t=e.Controls.select("input");if(null!==t&&1===t.length)return t[0];throw"Unable to retrieve the input control for "+e.Name}function r(e){var t,l,r;try{for(r=0;e.childNodes.length>r;r+=1)if(8===e.childNodes[r].nodeType){if(l=e.childNodes[r].data,t=l.match(/SPField\w+/),null!==t)return t[0];break}}catch(o){n("getSPFieldType: Error getting field type",o)}return null}function o(e){var t=null;switch(e.type){case"SPFieldText":t=new b(e);break;case"SPFieldText":t=new b(e);break;case"SPFieldText":t=new b(e);break;default:t=new f(e)}return t}function i(e){var t=null;try{if(null===e.controlsCell&&(e.controlsCell=e.labelCell.next()),e.type=r(e.controlsCell),null===e.type)return null;t=o(e)}catch(l){n("createSPField: Error creating field for "+e.name,l)}return t}function a(l,r,o){var i,a,u=null,s="Unknown field";try{if(o)i=l;else if(i=l.children()[0],null===i||"NOBR"===i.nodeName)return null;s=e(i).text().trim(),a=s.endsWith(" *"),!0===a&&(s=s.substring(0,s.length-2)),u={name:s,label:e(i),labelRow:e(l.parentNode),labelCell:l,isRequired:a,controlsRow:t(r)?null:e(r.parentNode),controlsCell:t(r)?null:r,type:null,spField:null}}catch(d){n("getFieldParams: Error getting field parameters "+s,d)}return u}function u(){if(null===y){var t,n,l=e("table.ms-formtable td.ms-formlabel"),r=e("table.ms-formtable td.ms-formbodysurvey"),o=l.length;for(m=r.length>0,y={},t=0;o>t;t+=1)n=a(l[t],r[t],m),null!==n&&(y[n.name]=n)}}function s(e,t,n){n?(e.show(),null!==t&&t.show()):(e.hide(),null!==t&&t.hide())}function d(e,l){u();var r=y.get(e);return t(r)?(n("toggleSPField: Unable to find a SPField named "+e+" - "+l),void 0):(s(r.labelRow,r.controlsRow,l),void 0)}function h(e){e.ReadOnlyLabel&&e.ReadOnlyLabel.update(e.GetValue())}function c(t,n){try{e(t.Controls).hide(),null===t.ReadOnlyLabel&&(t.ReadOnlyLabel=e("<div/>").addClass("sputility-readonly").after(t.Controls)),t.ReadOnlyLabel.html(n),t.ReadOnlyLabel.show()}catch(l){alert("Error making "+t.Name+" read only. "+(""+l))}return t}function f(e){this._init(e)}function b(e){this._init(e),this.Textbox=l(this)}var y=null,p=!1,m=!1,w=0;return f.prototype._init=function(e){this.Label=e.label,this.LabelRow=e.labelRow,this.Name=e.name,this.IsRequired=e.isRequired,this.Type=e.type,this.Controls=e.controlsCell.firstDescendant(),this.ControlsRow=e.controlsRow,this.ReadOnlyLabel=null},f.prototype.Show=function(){return s(this.LabelRow,this.ControlsRow,!0),this},f.prototype.Hide=function(){return s(this.LabelRow,this.ControlsRow,!1),this},f.prototype.MakeReadOnly=function(){return c(this,""+this.GetValue())},f.prototype.MakeEditable=function(){try{this.Controls.hide(),null!==this.ReadOnlyLabel&&this.ReadOnlyLabel.hide()}catch(e){alert("Error making "+this.Name+" editable. "+(""+e))}return this},f.prototype.toString=function(){return this.Name},f.prototype.GetValue=function(){throw"GetValue not yet implemented for "+this.Type+" in "+this.Name},f.prototype.SetValue=function(){throw"SetValue not yet implemented for "+this.Type+" in "+this.Name},e.extend(b,f,{GetValue:function(){return this.Textbox.getValue()},SetValue:function(e){return this.Textbox.setValue(e),h(this),this}}),{Debug:function(e){return"boolean"==typeof e&&(p=e),p},GetSPFields:function(){return u(),y},GetSPField:function(e){u();var l=y[e];return t(l)?(n("GetSPField: Unable to find a SPField named "+e),null):(null===l.spField&&(l.spField=i(l)),l.spField)},HideSPField:function(e){d(e,!1)},ShowSPField:function(e){d(e,!0)}}}(jQuery);