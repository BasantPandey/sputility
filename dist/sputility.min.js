/*! SPUtility.js - v0.1.0 - 2013-03-17
* https://github.com/kitmenke/jquery.sputility
* Copyright (c) 2013 Kit Menke; Licensed MIT */
Object.create||(Object.create=function(t){function e(){}if(arguments.length>1)throw Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e}),Number.prototype.formatMoney=function(t,e,n){t=isNaN(t=Math.abs(t))?2:t,e=void 0===e?".":e,n=void 0===n?",":n;var r=this,o=0>r?"-":"",l=parseInt(r=Math.abs(+r||0).toFixed(t),10)+"",i=(i=l.length)>3?i%3:0;return o+(i?l.substr(0,i)+n:"")+l.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+n)+(t?e+Math.abs(r-l).toFixed(t).slice(2):"")},function(t,e){"use strict";function n(t){return t===void 0}function r(t,e){var r;if(F){if(e){t+="\r\n";for(r in e)e.hasOwnProperty(r)&&(t+=r+": "+e[r]+"\r\n")}n(console)?(O+=1,3===O&&(t="More than 3 errors (additional errors will not be shown):\r\n"+t),3>=O&&alert(t)):console.error(t)}}function o(t){if("string"==typeof t){var e=t.match(/[0-9,.]+/g);null!==e&&(t=e[0].replace(/,/g,""),t=parseFloat(t))}return t}function l(t){if(null===t.Controls)return null;var n=e(t.Controls).find("input");if(null!==n&&1===n.length)return n[0];throw"Unable to retrieve the input control for "+t.Name}function i(t){var e,n,o;try{for(o=0;t.childNodes.length>o;o+=1)if(8===t.childNodes[o].nodeType){if(n=t.childNodes[o].data,e=n.match(/SPField\w+/),null!==e)return e[0];break}}catch(l){r("getSPFieldType: Error getting field type",l)}return null}function a(t){var e=null;switch(t.type){case"SPFieldText":e=new b(t);break;case"SPFieldNumber":e=new m(t);break;case"SPFieldCurrency":e=new v(t);break;default:e=new y(t)}return e}function s(t){var n=null;try{if(null===t.controlsCell&&(t.controlsCell=e(t.labelCell).next()[0]),t.type=i(t.controlsCell),null===t.type)return null;n=a(t)}catch(o){r("createSPField: Error creating field for "+t.name,o)}return n}function u(t,o,l){var i,a,s=null,u="Unknown field";try{if(l)i=t;else if(i=e(t).children()[0],null===i||"NOBR"===i.nodeName)return null;u=e(i).text().trim(),a=u.lastIndexOf(" *")===u.length-2,!0===a&&(u=u.substring(0,u.length-2)),s={name:u,label:e(i),labelRow:e(t.parentNode),labelCell:t,isRequired:a,controlsRow:n(o)?null:e(o.parentNode),controlsCell:n(o)?null:o,type:null,spField:null}}catch(c){r("getFieldParams: Error getting field parameters "+u,c)}return s}function c(){if(null===w){var t,n,r=e("table.ms-formtable td.ms-formlabel"),o=e("table.ms-formtable td.ms-formbodysurvey"),l=r.length;for(g=o.length>0,w={},t=0;l>t;t+=1)n=u(r[t],o[t],g),null!==n&&(w[n.name]=n)}}function d(t,e,n){n?(t.show(),null!==e&&e.show()):(t.hide(),null!==e&&e.hide())}function h(t,e){c();var o=w.get(t);return n(o)?(r("toggleSPField: Unable to find a SPField named "+t+" - "+e),void 0):(d(o.labelRow,o.controlsRow,e),void 0)}function p(t){t.ReadOnlyLabel&&t.ReadOnlyLabel.update(t.GetValue())}function f(t,n){try{e(t.Controls).hide(),null===t.ReadOnlyLabel&&(t.ReadOnlyLabel=e("<div/>").addClass("sputility-readonly").after(t.Controls)),t.ReadOnlyLabel.html(n),t.ReadOnlyLabel.show()}catch(r){alert("Error making "+t.Name+" read only. "+(""+r))}return t}function y(t){this.Label=t.label,this.LabelRow=t.labelRow,this.Name=t.name,this.IsRequired=t.isRequired,this.Type=t.type,this.Controls=e(t.controlsCell).children()[0],this.ControlsRow=t.controlsRow,this.ReadOnlyLabel=null}function b(t){y.call(this,t),this.Textbox=l(this)}function m(t){b.call(this,t)}function v(t){m.call(this,t),this.FormatOptions={eventHandler:null,autoCorrect:!1,decimalPlaces:2}}var w=null,F=!1,g=!1,O=0;y.prototype.Show=function(){return d(this.LabelRow,this.ControlsRow,!0),this},y.prototype.Hide=function(){return d(this.LabelRow,this.ControlsRow,!1),this},y.prototype.MakeReadOnly=function(){return f(this,""+this.GetValue())},y.prototype.MakeEditable=function(){try{this.Controls.hide(),null!==this.ReadOnlyLabel&&this.ReadOnlyLabel.hide()}catch(t){alert("Error making "+this.Name+" editable. "+(""+t))}return this},y.prototype.toString=function(){return this.Name},y.prototype.GetValue=function(){throw"GetValue not yet implemented for "+this.Type+" in "+this.Name},y.prototype.SetValue=function(){throw"SetValue not yet implemented for "+this.Type+" in "+this.Name},b.prototype=Object.create(y.prototype),b.prototype.GetValue=function(){return e(this.Textbox).val()},b.prototype.SetValue=function(t){return e(this.Textbox).val(t),p(this),this},m.prototype=Object.create(b.prototype),m.prototype.GetValue=function(){return o(e(this.Textbox).val())},v.prototype=Object.create(m.prototype),v.prototype.Format=function(){this.FormatOptions.autoCorrect?(this.FormatOptions.eventHandler=function(){this.SetValue(this.GetFormattedValue())}.bindAsEventListener(this),Event.observe(this.Textbox,"change",this.FormatOptions.eventHandler),this.FormatOptions.eventHandler()):this.FormatOptions.eventHandler&&(Event.stopObserving(this.Textbox,"change",this.FormatOptions.eventHandler),this.FormatOptions.eventHandler=null)},v.prototype.GetFormattedValue=function(){var t=this.GetValue();return"number"==typeof t&&(t="$"+t.formatMoney(this.FormatOptions.decimalPlaces)),t},v.prototype.MakeReadOnly=function(){return f(this,this.GetFormattedValue())},t.SPUtility={Debug:function(t){return"boolean"==typeof t&&(F=t),F},GetSPFields:function(){return c(),w},GetSPField:function(t){c();var e=w[t];if(n(e))throw"GetSPField: Unable to find a SPField named "+t;return null===e.spField&&(e.spField=s(e)),e.spField},HideSPField:function(t){h(t,!1)},ShowSPField:function(t){h(t,!0)}}}(window,jQuery);